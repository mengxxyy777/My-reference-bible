# 逆元、除法同余、容斥原理

## 逆元

​	逆元也就是倒数的意思。求逆元的原理是费马小定理。

## 除法同余

​	为什么除法同余与加减乘的不一样？因为对于除数被除数分别取余是不行的，得到的结果对不上。

​	故如果计算a / b在模p的结果，需要除法同余，首先需要保证：

​		1）a / b可以整除；

​		2）p是质数；

​		3）必须保证b和p互质。实际上题目一般会给模数是一个很大的质数，最常见的1e9+7。

​	步骤如下：

​		1）求1 / b的乘法同余数，也就是b的逆元，b的逆元 = b的 p-2 次方模p，这个过程用乘法快速幂加速；

​		2）(a / b) % p 的结果等于 ( (a % p) * (b的逆元) ) % p。

## 连续数字逆元的线性递推

​	模板题：https://www.luogu.com.cn/problem/P3811

​	模数还是p，从1...n求每个数字的逆元。在知道前面的逆元时，是可以递推出后面的逆元的。

​	inv[ i ]表示i的逆元。

### 从左往右线性递推

​	inv[1] = 1

​	inv[ i ] = (int) (p - (long long) inv[p % i] * (p / i) % p)

## 连续阶乘逆元的线性递推

​	模数依然是p，从1!、2! ... n!求每个数字的逆元。此时需要从右向左线性递推。

​	inv[ i ]表示 i! 的逆元。

### 从右往左线性递推

​	先求n!乘法同余的结果，假设为a，求a的逆元假设为b。

​	inv[ n ] = b

​	inv[ i ] = ( (long long) (i + 1) * inv[i + 1] ) % p

## 如何快速求组合数

​	利用上面的连续阶乘逆元，存好之后想用谁就取谁就可以了。

### 演示code

```cpp
#include <iostream>
using namespace std;

const int mod = 1000000007;

// fac[i]表示i! % mod的值
long long fac[1005];
// inv[i]表示i! % mod的逆元:（1 / i!）
long long inv[1005];

long long qp(long long a, int b)
{
	long long ans = 1;
	while (b > 0)
	{
		if (b & 1)
		{
			ans = (ans * a) % mod;
		}
		a = (a * a) % mod;
		b >>= 1;
	}
	return ans;
}

// n! / (m! * (n-m)!)
int c(int n, int m)
{
	long long ans = fac[n];
	ans = (ans * inv[m]) % mod;
	ans = (ans * inv[n - m]) % mod;
	return (int)ans;
}

int main()
{
	fac[1] = 1;
	for (int i = 2; i < 1001; i++)
	{
		fac[i] = ((long long)i * fac[i - 1]) % mod;
	}

	inv[1000] = qp(fac[1000], mod - 2);
	for (int i = 999; i >= 0; i--)
	{
		inv[i] = ((long long)(i + 1) * inv[i + 1]) % mod;
	}

	cout << c(537, 367);

	return 0;
}
```

## 容斥原理

​	参考离散数学有关内容。

### 练习题目

​	https://codeforces.com/problemset/problem/803/F、https://www.luogu.com.cn/problem/CF803F

​	上述习题扩展：最大公约数为k呢？直接将k的倍数留下并都除以k，问题就转化为上面习题了。

​	减去四种硬币非法状态的并集数量：https://www.luogu.com.cn/problem/P1450

​	https://leetcode.cn/problems/number-of-music-playlists/    本题关键解法放在下面了

![image-20250204151119214](C:\Users\21702\AppData\Roaming\Typora\typora-user-images\image-20250204151119214.png)

![image-20250204152225683](C:\Users\21702\AppData\Roaming\Typora\typora-user-images\image-20250204152225683.png)

![image-20250204152153229](C:\Users\21702\AppData\Roaming\Typora\typora-user-images\image-20250204152153229.png)