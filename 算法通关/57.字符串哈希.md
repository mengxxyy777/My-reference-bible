# 字符串哈希

## 哈希函数

​	就是把复杂样本变成数字的函数。以后复杂样本之间的对比就变成了数字之间的对比。

​	字符串哈希就是字符串与数字的对应。

### 哈希函数的性质

​	1）输入参数的可能性是无限的，输出的值范围相对有限。

​	2）输入同样的样本一定得到同样的输出，也就是哈希函数没有任何随机机制。

​	3）输入不同的样本也可能得到相同的输出值，这种情况叫哈希碰撞。

​	4）输入大量不同的样本，得到大量的输出值，会几乎均匀地分布在整个输出域上。

### 总结

​	哈希函数种类很多，但是都符合上述性质。并且哈希碰撞理论上无法避免，选取一个好的哈希函数能大大降低碰撞的概率。

## 字符串哈希

​	如何得到整个串的哈希值呢？

​	首先要理解：

​		1）long long类型自然溢出，计算加、减、乘时，自然溢出后的状态天然等于正确结果对2的64次方取模的值。

​		2）字符串转化为base进制的数字并让其自然溢出。

​		3）base可以选择一些质数比如：433、499、599、1000000007，也可以选择已经被证实了很好用的值：31、131、1313、13131、131313等。这里建议选几百的质数，不要选经典值，会被出题人刻意构造碰撞。

​		4）转化时让每一位的值从1开始，而不是0，这样就得到了一个long long类型的数字代表字符串。

​		5）利用数字的比较去代替字符串的比较，可以大大减小时间复杂度。

​	字符串哈希理论上来讲一旦碰撞就会出错，但是面对现实中的算法样本量较少，出错概率很低，即使出错了，也可以换其他质数作为base，一定能赌赢的！

## 练习题目

​	模板题：https://www.luogu.com.cn/problem/P3370

​	https://leetcode.cn/problems/unique-substrings-with-equal-digit-frequency/

## 如何快速得到字符串的任意子串的哈希值

​	准备一个pow数组，pow[i]代表base的i次方。再准备一个hash数组，hash[i]代表字符串0到i这部分的哈希值。

​	当我们想要求字符串l到r的哈希值时，就可以在O(1)的时间复杂度内得到：hash[ s[l...r] ] = hash[r] - hash[l - 1] * base的(r - l + 1)次方。其中base的某次方我们可以在pow数组中得到。

​	为什么是对的呢？其实hash[l - 1] * base的(r - l + 1)次方相当于将hash[l - 1]在base进制下左移(r - l + 1)位，对齐了hash[r]的高位，作差消掉，剩下的就是[l...r]这段的哈希值了。

​	该方法可以替代KMP，因为s2的长度是固定的，将其哈希值计算出后，在s1中依次枚举长度与s2相同的子串，遇到哈希值相同的即为匹配成功。该方法进行子串查询理解难度上要比KMP简单。

### code

```cpp
long long pow[100005];
long long h[100005];

int n = s1.size();
int m = s2.size();

// 预处理的两个数组
pow[0] = 1;
for (int i = 1; i < n; i++)
{
    pow[i] = pow[i - 1] * base;
}
hash[0] = s[0] - 'a' + 1;
for (int i = 1; i < n; i++)
{
	  hash[i] = hash[i - 1] * base + s[i] - 'a' + 1;
}

// 给定一个l...r区间，返回这段子串的哈希值
long long hval(int l, int r)
{
    long long ans = hash[r];
	  if (l > 0)
	  {
		    ans -= hash[l - 1] * pow[r - l + 1];
	  }
	  return ans;
}
```

## 练习题目

​	https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/

​	https://leetcode.cn/problems/repeated-string-match/

​	https://leetcode.cn/problems/substring-with-concatenation-of-all-words/

​	https://www.luogu.com.cn/problem/P3763